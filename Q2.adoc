== Q2: How do I manage the authentication system with an OIDC?

== What is OpenID ?

verify the identity of users based on the authentication performed by an Authorization Server and obtain user profile information in an interoperable and REST-like manner.

=== How does OpenID Connect work?

OpenID Connect ennables an Internet identity ecosystem.
It follows these steps :

1. The User navigates to a website via a web browser.
2. The User clicks sign-in and types their username and password
3. The RP (Client) sends an authentication request to the OpenID Provider (OP).
4. The OP authenticates the User and obtains authorization.
5. The OP sends an Identity Token to the RP and usually an Access Token.
6. The RP can send a request with Access Token to the User device.
7. the UserInfo Endpoint returns Claims about the End-User.

=== What are the benefits of OpenID Connect?

- Simplified User Authentication
- Secure User Authentication
- Single Sign-On (SSO)
- User Profile Information
- Standardized
- Interoperable
- REST-like

=== What are the components of OpenID Connect?

- **End-User**: The person who uses the RP.
- **RP (Relying Party)**: The application that wants to authenticate the End-User.
- **OP (OpenID Provider)**: The service that authenticates the End-User and provides Claims to the RP.
- **Authorization Server**: The server that authenticates the End-User and issues Access Tokens.
- **Identity Token**: A JWT that contains information about the End-User.

== What is Keycloak ?

Keycloak is an open-source Identity and Access Management solution that makes it easy to secure applications and services with little to no code.

=== How does Keycloak works ?

Keycloak works by providing an authentication server that can be used to secure applications and services. It supports OpenID Connect, OAuth 2.0, and SAML 2.0 protocols, making it easy to integrate with existing systems.

Keycloak provides a wide range of features, including:

- User Authentication
- User Registration
- User Management
- Role-Based Access Control
- Single Sign-On
- Multi-Factor Authentication
- Social Login
- User Sessions
- Account Management
- Admin Console
- REST API
- Scalability

=== What are the main components of Keycloak ?

Keycloak has 2 main components, including:

- **Keycloak Server**: The server that provides the authentication and authorization services. It includes the API and a graphical interface
- **Keycloak Client**: The client that interacts with the Keycloak server to authenticate users and obtain tokens.

== How to integrate Keycloak with an OIDC ?

To integrate Keycloak with an OIDC, we need to follow these steps:

1. **Create a Realm**: Create a new realm in Keycloak to manage the authentication and authorization settings for the application.
2. **Create a Client**: Create a new client in the realm to represent the application.
3. **Configure the Client**: Configure the client settings, such as the client ID, client secret, and redirect URIs.
4. **Integrate the Client**: Integrate the client with the application by adding the necessary code to handle the authentication flow.
5. **Test the Integration**: Test the integration by logging in to the application and verifying that the authentication works as expected.

== How to secure an application with Keycloak ?

To secure an application with Keycloak, we need to follow these steps:

1. **Add Keycloak Dependencies**: Add the Keycloak dependencies to the application, such as the Keycloak adapter.
2. **Configure Keycloak Adapter**: Configure the Keycloak adapter in the application to connect to the Keycloak server.
3. **Secure Endpoints**: Secure the application endpoints by adding Keycloak security constraints.
4. **Add Keycloak Login Page**: Add the Keycloak login page to the application to handle the authentication flow.

== Architecture Diagram

=== **Identifier les composants :**
- **Client (Frontend) :** Interface utilisateur (web ou mobile).
- **Serveur d'application (Backend) :** Logique métier et API.
- **Keycloak Server :** Serveur d'authentification et d'autorisation.
- **Base de données :** Stockage des données utilisateur et de l'application.
- **Services externes :** Google OAuth, Polytech LDAP.


=== **Définir les interactions :**
  - Flux d'authentification entre le client, le serveur d'application et Keycloak.
  - Intégration avec Google OAuth et Polytech LDAP pour l'authentification.
  - Communication entre le serveur d'application et la base de données.

== Deployement Diagram

=== **Identifier l'infrastructure :**
  - Serveurs physiques ou virtuels.
  - Services cloud (AWS, Azure, GCP).
  - Conteneurs (Docker, Kubernetes).

=== **Définir la topologie :**
  - Placement des composants sur les serveurs/conteneurs.
  - Configuration réseau (load balancers, firewalls).

== Sequence Diagram

=== **Scénarios à couvrir :**
  - Création de compte utilisateur (vanilla, via Polytech, via Google).
  - Connexion utilisateur (vanilla, Polytech).
  - Association d'un compte Google avec un compte Beep.

=== **Définir les acteurs et les composants :**
  - Utilisateur, Client, Serveur d'application, Keycloak, Google OAuth, Polytech LDAP.

=== **Décrire les étapes :**
  - Pour chaque scénario, listez les étapes d'interaction entre les composants.
  - Par exemple, pour la création de compte via Google :
    1. L'utilisateur clique sur "S'inscrire avec Google".
    2. Le client redirige vers Google OAuth.
    3. Google authentifie l'utilisateur et redirige vers Keycloak avec un code d'autorisation.
    4. Keycloak échange le code contre un token.
    5. Keycloak crée un compte utilisateur dans Beep.
    6. L'utilisateur est redirigé vers l'application avec un token d'accès.


== POC (Proof of Concept)

== OIDC