== Q2: How do I manage the authentication system with an OIDC?

== What is OpenID?

OpenID is a protocol that allows for the verification of user identities based on authentication performed by an Authorization Server and obtains user profile information in an interoperable and REST-like manner.

=== How does OpenID Connect work?

OpenID Connect enables an Internet identity ecosystem. It follows these steps:

1. The User navigates to a website via a web browser.
2. The User clicks sign-in and types their username and password.
3. The RP (Client) sends an authentication request to the OpenID Provider (OP).
4. The OP authenticates the User and obtains authorization.
5. The OP sends an Identity Token to the RP and usually an Access Token.
6. The RP can send a request with the Access Token to the User device.
7. The UserInfo Endpoint returns Claims about the End-User.

=== What are the benefits of OpenID Connect?

- Simplified User Authentication
- Secure User Authentication
- Single Sign-On (SSO)
- User Profile Information
- Standardized
- Interoperable
- REST-like

=== What are the components of OpenID Connect?

- **End-User**: The person who uses the RP.
- **RP (Relying Party)**: The application that wants to authenticate the End-User.
- **OP (OpenID Provider)**: The service that authenticates the End-User and provides Claims to the RP.
- **Authorization Server**: The server that authenticates the End-User and issues Access Tokens.
- **Identity Token**: A JWT that contains information about the End-User.

== What is Keycloak?

Keycloak is an open-source Identity and Access Management solution that makes it easy to secure applications and services with little to no code.

=== How does Keycloak work?

Keycloak works by providing an authentication server that can be used to secure applications and services. It supports OpenID Connect, OAuth 2.0, and SAML 2.0 protocols, making it easy to integrate with existing systems.

Keycloak provides a wide range of features, including:

- User Authentication
- User Registration
- User Management
- Role-Based Access Control
- Single Sign-On
- Multi-Factor Authentication
- Social Login
- User Sessions
- Account Management
- Admin Console
- REST API
- Scalability

=== What are the main components of Keycloak?

Keycloak has two main components, including:

- **Keycloak Server**: The server that provides the authentication and authorization services. It includes the API and a graphical interface.
- **Keycloak Client**: The client that interacts with the Keycloak server to authenticate users and obtain tokens.

== How to integrate Keycloak with an OIDC?

To integrate Keycloak with an OIDC, we need to follow these steps:

1. **Create a Realm**: Create a new realm in Keycloak to manage the authentication and authorization settings for the application.
2. **Create a Client**: Create a new client in the realm to represent the application.
3. **Configure the Client**: Configure the client settings, such as the client ID, client secret, and redirect URIs.
4. **Integrate the Client**: Integrate the client with the application by adding the necessary code to handle the authentication flow.
5. **Test the Integration**: Test the integration by logging in to the application and verifying that the authentication works as expected.

== How to secure an application with Keycloak?

To secure an application with Keycloak, we need to follow these steps:

1. **Add Keycloak Dependencies**: Add the Keycloak dependencies to the application, such as the Keycloak adapter.
2. **Configure Keycloak Adapter**: Configure the Keycloak adapter in the application to connect to the Keycloak server.
3. **Secure Endpoints**: Secure the application endpoints by adding Keycloak security constraints.
4. **Add Keycloak Login Page**: Add the Keycloak login page to the application to handle the authentication flow.

== Architecture Diagram

=== Identify the components:
- **Client (Frontend)**: User interface (web or mobile).
- **Application Server (Backend)**: Business logic and API.
- **Keycloak Server**: Authentication and authorization server.
- **Database**: Storage for user and application data.
- **External Services**: Google OAuth, Polytech LDAP.

=== Define the interactions:
- Authentication flow between the client, application server, and Keycloak.
- Integration with Google OAuth and Polytech LDAP for authentication.
- Communication between the application server and the database.

== Deployment Diagram

=== Identify the infrastructure:
- Physical or virtual servers.
- Cloud services (AWS, Azure, GCP).
- Containers (Docker, Kubernetes).

=== Define the topology:
- Placement of components on servers/containers.
- Network configuration (load balancers, firewalls).

== Sequence Diagram

=== Scenarios to cover:
- User account creation (vanilla, via Polytech, via Google).
- User login (vanilla, Polytech).
- Association of a Google account with a Beep account.

=== Define the actors and components:
- User, Client, Application Server, Keycloak, Google OAuth, Polytech LDAP.

=== Describe the steps:
- For each scenario, list the interaction steps between the components.
- For example, for account creation via Google:
  1. The user clicks on "Sign up with Google."
  2. The client redirects to Google OAuth.
  3. Google authenticates the user and redirects to Keycloak with an authorization code.
  4. Keycloak exchanges the code for a token.
  5. Keycloak creates a user account in Beep.
  6. The user is redirected to the application with an access token.

== POC (Proof of Concept)

== OIDC